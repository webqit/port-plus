(()=>{var Ye=Object.defineProperty;var de=(r,e)=>{for(var t in e)Ye(r,t,{get:e[t],enumerable:!0})};var Re={};de(Re,{BroadcastChannelPlus:()=>pe,MessageChannelPlus:()=>me,MessageEventPlus:()=>j,MessagePortPlus:()=>O,Observer:()=>We,RelayPort:()=>he,StarPort:()=>X,WebSocketPort:()=>Q});function x(r){return!Array.isArray(r)&&typeof r=="object"&&r}function G(r){return typeof r}function T(r){return Array.isArray(r)}function K(r){return typeof r=="function"}function ge(r){return r===null||r===""}function z(r){return arguments.length&&(r===void 0||typeof r>"u")}function y(r){return Array.isArray(r)||typeof r=="object"&&r||K(r)}function ye(r){return ge(r)||z(r)||r===!1||r===0||y(r)&&!Object.keys(r).length}function C(r){return K(r)||r&&{}.toString.call(r)==="[object function]"}function se(r){return r instanceof String||typeof r=="string"&&r!==null}function _e(r){return!se(r)&&!z(r.length)}function $(r,...e){if(!r||!["object","function"].includes(typeof r))throw new Error("Argument #1 must be of type object");let t=r[Symbol.for("wq")];if(t||(t=new ie,Object.defineProperty(r,Symbol.for("wq"),{value:t,enumerable:!1,configurable:!1,writable:!1})),!e.length)return t;let n,o;for(;n=e.shift();)(o=t)&&!(t=t.get(n))&&(t=new ie,o.set(n,t));return t}var ie=class extends Map{};var j=class extends MessageEvent{#e;get originalTarget(){return this.#e}#t;get eventID(){return this.#t}#r;get data(){return this.#r}#o;get live(){return this.#o}#a;get bubbles(){return this.#a}#f;get forwarded(){return this.#f}#s;get honourDoneMutationFlags(){return this.#s}#n=[];get ports(){return this.#n}constructor(e,{originalTarget:t=null,type:n="message",eventID:o,live:s=!1,honourDoneMutationFlags:u=!1,bubbles:f=!1,forwarded:a=!1,ports:i=[]}={}){if(n&&typeof n!="string")throw new TypeError("Where specified, wqEventOptions.type must be a string");if(super(n),this.#r=e,this.#e=t,this.#t=o,this.#o=s,this.#a=f,this.#f=a,this.#s=u,this.#n=i,this.#n.forEach(l=>O.upgradeInPlace(l)),y(this.#r)&&this.#o){if(typeof o!="string")throw new TypeError("eventID must be a non-empty string");we.call(t,this.#r,this.#t,{honourDoneMutationFlags:this.#s})}}#u=!1;get immediatePropagationStopped(){return this.#u}stopImmediatePropagation(){this.#u=!0,this.#i=!0,super.stopImmediatePropagation()}#i=!1;get propagationStopped(){return this.#i}stopPropagation(){this.#i=!0,super.stopPropagation()}#l=!1;get defaultPrevented(){return this.#l}preventDefault(){this.#l=!0,super.preventDefault()}respondWith(e,t=[]){for(let n of this.#n)n.postMessage(e,t);return!!this.#n.length}};var Le={};de(Le,{any:()=>_t,apply:()=>Te,batch:()=>Ce,construct:()=>Ie,defineProperties:()=>vt,defineProperty:()=>te,deleteProperties:()=>Pt,deleteProperty:()=>re,get:()=>N,getOwnPropertyDescriptor:()=>fe,getOwnPropertyDescriptors:()=>wt,getPrototypeOf:()=>Ee,has:()=>ue,intercept:()=>bt,isExtensible:()=>Me,map:()=>xt,observe:()=>qe,ownKeys:()=>Se,path:()=>gt,preventExtensions:()=>je,reduce:()=>De,set:()=>W,setPrototypeOf:()=>Ae,subtree:()=>yt});function F(r,e=!0){return T(r)?r:!e&&x(r)?[r]:r!==!1&&r!==0&&ye(r)?[]:_e(r)?Array.prototype.slice.call(r):x(r)?Object.values(r):[r]}var v=(r,...e)=>$(r,"observerAPI",...e),J=(r,e)=>r instanceof Promise?r.then(e):e(r),ae={};var B=class{constructor(e,t){this.registry=e,Object.assign(this,{...t,target:e.target}),this.params.signal&&this.params.signal.addEventListener("abort",()=>this.remove())}remove(){return this.removed=!0,this.registry.removeRegistration(this)}};var Y=class extends B{constructor(){super(...arguments),this.emit.currentRegistration=this,Object.defineProperty(this,"abortController",{value:new AbortController}),Object.defineProperty(this,"signal",{value:this.abortController.signal}),ae.setMaxListeners?.(0,this.signal)}remove(){this.abortController.abort(),super.remove()}fire(e){if(this.emit.recursionTarget&&!["inject","force-async","force-sync"].includes(this.params.recursions))return;let t=e,n=this.filter;if(n!==1/0&&(n=F(n,!1))&&(t=e.filter(s=>n.includes(s.key))),this.params.diff&&(t=t.filter(s=>s.type!=="set"||s.value!==s.oldValue)),!t.length)return;if(["inject","defer"].includes(this.params.recursions)){if(this.emit.recursionTarget){this.emit.recursionTarget.push(...t);return}this.emit.recursionTarget=this.params.recursions==="inject"?t:[]}let o=this.filter===1/0||Array.isArray(this.filter)?this.emit(t,this):this.emit(t[0],this);return J(o,s=>{let u=this.emit.recursionTarget;return delete this.emit.recursionTarget,this.params.recursions==="defer"&&u?.length?this.emit.currentRegistration.fire(u):s})}};var V=class{constructor(e){this.target=e,this.entries=[]}addRegistration(e){return this.entries.push(e),e}removeRegistration(e){this.entries=this.entries.filter(t=>t!==e)}static _getInstance(e,t,n=!0,o=this.__namespace){if(!y(t))throw new Error(`Subject must be of type object; "${G(t)}" given!`);let s=this;return o&&v(globalThis,"observerAPI","namespaces").has(e+"-"+o)&&(s=v(globalThis,"observerAPI","namespaces").get(e+"-"+o),e+="-"+o),!v(t,"registry").has(e)&&n&&v(t,"registry").set(e,new s(t)),v(t,"registry").get(e)}static _namespace(e,t,n=null){if(e+="-"+t,arguments.length===2)return v(globalThis,"observerAPI","namespaces").get(e);if(!(n.prototype instanceof this))throw new Error(`The implementation of the namespace ${this.name}.${t} must be a subclass of ${this.name}.`);v(globalThis,"observerAPI","namespaces").set(e,n),n.__namespace=t}};var P=class{constructor(e,t){if(this.target=e,!t.operation)throw new Error("Descriptor operation must be given in definition!");Object.assign(this,t)}};var L=class extends V{static getInstance(e,t=!0,n=null){return super._getInstance("listeners",...arguments)}static namespace(e,t=null){return super._namespace("listeners",...arguments)}constructor(e){super(e),this.batches=[]}addRegistration(e,t,n){return super.addRegistration(new Y(this,{filter:e,emit:t,params:n}))}emit(e,{eventsArePropertyDescriptors:t=!1,eventIsArrayMethodDescriptor:n=!1}={}){if(this.batches.length){let o=this.batches[0].params.arrayMethodName;this.batches[0].snapshots.push({events:[...e],arrayMethodName:o,eventsArePropertyDescriptors:t,eventIsArrayMethodDescriptor:n});return}this.$emit(this.entries,[{events:e,eventsArePropertyDescriptors:t,eventIsArrayMethodDescriptor:n}])}$emit(e,t){let n=0,o=0,s=0;for(let l of e)n+=1,l.params.withPropertyDescriptors&&(o+=1),l.params.withArrayMethodDescriptors&&(s+=1);let u=[],f=[],a=[],i=[];for(let l of t){let c=l.arrayMethodName,m=l.eventsArePropertyDescriptors,d=l.eventIsArrayMethodDescriptor;for(let p of l.events)if(c&&(p.operation=c),o&&(s&&u.push(p),d||s!==n&&f.push(p)),o!==n){let b=p;if(m){let{target:_,type:w,...g}=p;b=new P(_,{type:"set",...g}),Object.defineProperty(b,"value","get"in g.value?{get:()=>g.value.get()}:{value:g.value.value}),g.oldValue&&Object.defineProperty(b,"oldValue","get"in g.oldValue?{get:()=>g.oldValue.get()}:{value:g.oldValue.value})}s&&a.push(b),d||s!==n&&i.push(b)}}for(let l of e)l.params.withPropertyDescriptors?l.params.withArrayMethodDescriptors?u.length&&l.fire(u):f.length&&l.fire(f):l.params.withArrayMethodDescriptors?a.length&&l.fire(a):i.length&&l.fire(i)}batch(e,t={}){this.batches.unshift({entries:[...this.entries],snapshots:[],params:t});let n=e();return J(n,o=>{let s=this.batches.shift();return s.snapshots.length&&this.$emit(s.entries,s.snapshots),o})}};var Z=class extends B{exec(e,t,n){return this.running||!this.traps[e.operation]?t(...Array.prototype.slice.call(arguments,2)):(this.running=!0,this.traps[e.operation](e,n,(...o)=>(this.running=!1,t(...o))))}};var R=class extends V{static getInstance(e,t=!0,n=null){return super._getInstance("traps",...arguments)}static namespace(e,t=null){return super._namespace("traps",...arguments)}addRegistration(e){return super.addRegistration(new Z(this,e))}emit(e,t=null){let n=this;return function o(s,...u){let f=n.entries[s];return f?f.exec(e,(...a)=>o(s+1,...a),...u):t?t(e,...u):u[0]}(0)}};var Oe={};de(Oe,{accessorize:()=>ht,proxy:()=>ve,unaccessorize:()=>dt,unproxy:()=>ee});var Be=Symbol("wqOriginal");function ht(r,e,t={}){r=Pe(r);let n=v(r,"accessorizedProps");function o(a){let i,l=r;do i=Object.getOwnPropertyDescriptor(l,a);while(!i&&(l=Object.getPrototypeOf(l)));return i?{proto:l,descriptor:i}:{descriptor:{value:void 0,configurable:!0,enumerable:!0,writable:!0}}}function s(a){if(n.has(a+""))return!0;let i=o(a);i.getValue=function(m=!1){return m?this.descriptor:this.descriptor.get?this.descriptor.get():this.descriptor.value},i.setValue=function(m,d=!1){if(this.dirty=!0,d){this.descriptor=m;return}return this.descriptor.set?this.descriptor.set(m)!==!1:(this.descriptor.value=m,!0)},i.intact=function(){let m=Object.getOwnPropertyDescriptor(r,a);return m?.get===c.get&&m?.set===c.set&&n.get(a+"")===this},i.restore=function(){return this.intact()?(this.proto&&this.proto!==r||!this.proto&&!this.dirty?delete r[a]:Object.defineProperty(r,a,this.descriptor),n.delete(a+""),!0):!1},n.set(isNaN(a)?a:parseInt(a),i);let{enumerable:l=!0}=i.descriptor,c={enumerable:l,configurable:!0};("value"in i.descriptor||i.descriptor.set)&&(c.set=function(m){return W(this,a,m,t)}),("value"in i.descriptor||i.descriptor.get)&&(c.get=function(){return N(this,a,t)});try{return Object.defineProperty(r,a,c),!0}catch{return n.delete(a+""),!1}}let f=(Array.isArray(e)?e:e===void 0?Object.keys(r):[e]).map(s);return e===void 0||Array.isArray(e)?f:f[0]}function dt(r,e,t={}){r=Pe(r);let n=v(r,"accessorizedProps");function o(f){return n.has(f+"")?n.get(f+"").restore():!0}let u=(Array.isArray(e)?e:e===void 0?Object.keys(r):[e]).map(o);return e===void 0||Array.isArray(e)?u:u[0]}function ve(r,e={},t=void 0){let n=Pe(r);if(typeof e.membrane=="boolean")throw new Error("The params.membrane parameter cannot be of type boolean.");if(e.membrane&&v(n,"membraneRef").has(e.membrane))return v(n,"membraneRef").get(e.membrane);let o={apply:(f,a,i)=>Te(f,a,i,void 0,e),construct:(f,a,i=null)=>Ie(f,a,i,e),defineProperty:(f,a,i)=>te(f,a,i,e),deleteProperty:(f,a)=>re(f,a,e),get:(f,a,i=null)=>{if(a===Be)return n;let l={...e,receiver:i},c=N(f,a,l);return Array.isArray(f)&&typeof c=="function"&&!/^class\s?/.test(Function.prototype.toString.call(c))?ve(c,{...e,arrayMethodName:a,membrane:i},t):e.chainable&&y(c)&&a!=="prototype"&&!(typeof c=="function"&&/^class\s?|\{\s\[native\scode\]\s\}$/.test(Function.prototype.toString.call(c)))?ve(c,e,t):c},getOwnPropertyDescriptor:(f,a)=>fe(f,a,e),getPrototypeOf:f=>Ee(f,e),has:(f,a)=>ue(f,a,e),isExtensible:f=>Me(f,e),ownKeys:f=>Se(f,e),preventExtensions:f=>je(f,e),set:(f,a,i,l=null)=>W(f,a,i,{...e,receiver:l}),setPrototypeOf:(f,a)=>Ae(f,a,e)},s=t?.(o)||o,u=new Proxy(n,s);return e.membrane&&v(n,"membraneRef").set(e.membrane,u),u}function ee(r){return r&&r[Be]||r}function Pe(r){if(!r||!y(r))throw new Error("Target must be of type object!");return ee(r)}var ne=class extends Array{get[Symbol.toStringTag](){return"Path"}static[Symbol.hasInstance](e){return Array.isArray(e)&&e[Symbol.toStringTag]==="Path"}};function gt(...r){return new ne(...r)}var U=class extends Array{get[Symbol.toStringTag](){return"Subtree"}static[Symbol.hasInstance](e){return Array.isArray(e)&&e[Symbol.toStringTag]==="Subtree"}};function yt(){return new U}function _t(){return 1/0}function De(r,e,t,n=s=>s,o={}){let s=e instanceof U;if(!(!s&&!e?.length))return function u(f,a,i,l){let c=l||a[i.level]instanceof U,m=c?1/0:a[i.level],d=c?!1:i.level===a.length-1;return f instanceof P&&f.operation!=="get"?i={...i,probe:"always"}:i.probe!=="always"&&(i={...i,probe:!d}),t(f,m,(p,...b)=>{let _=h=>{h instanceof P&&(h.path="key"in h?[h.key]:[],f instanceof P&&(h.path="key"in h?f.path.concat(h.key):f.path.slice(0),Object.defineProperty(h,"context",{get:()=>f,configurable:!0})))},w=b[0]||{},g=h=>{if(h instanceof P&&"argumentsList"in h)return;let I=D(h,!1);return J(I,M=>(h instanceof P?h.value=M:h=M,u(h,a,{...i,...w,keyInParent:h.key,level:i.level+1},c)))};if(oe(m)&&Array.isArray(p)){if(p.forEach(_),d)return n(p,...b);c&&p[0]instanceof P&&(p[0].operation!=="get"||o.asGet)&&n(p,...b);for(let h of p)g(h);return}return _(p),d?n(p,...b):g(p)},i)}(r,e.slice(0),{...o,level:0},s)}function qe(r,e,t,n={}){let o=D(r,!n.level);if(C(arguments[1])&&([,t,n={}]=arguments,e=1/0),!C(t))throw new Error(`Handler must be a function; "${G(t)}" given!`);if(e instanceof ne||e instanceof U)return De(o,e,qe,t,n);if(n={...n,descripted:!0},delete n.live,!y(o))return n.probe&&N(o,e,t,n)||void 0;let s=Ve(o,e,t,n);return n.probe?N(o,e,s,n):s()}function bt(r,e,t={}){let n=D(r);return x(e)||([,,,t={}]=arguments,e={[arguments[1]]:arguments[2]}),R.getInstance(n,!0,t.namespace).addRegistration({traps:e,params:t})}function fe(r,e,t=o=>o,n={}){return A(r,"getOwnPropertyDescriptor",{key:e},t,n)}function wt(r,e,t=o=>o,n={}){return A(r,"getOwnPropertyDescriptors",{key:e},t,n)}function Ee(r,e=n=>n,t={}){return A(r,"getPrototypeOf",{},e,t)}function Me(r,e=n=>n,t={}){return A(r,"isExtensible",{},e,t)}function Se(r,e=n=>n,t={}){return A(r,"ownKeys",{},e,t)}function ue(r,e,t=o=>o,n={}){return A(r,"has",{key:e},t,n)}function N(r,e,t=o=>o,n={}){let o,s=D(r,!n.level);return x(t)?[n,t]=[t,u=>u]:n.live&&(o=!0),e instanceof ne||e instanceof U?De(s,e,N,t,{...n,asGet:!0}):Ot(s,e,u=>{let f=[...u];return function a(i,l,c){if(!l.length)return c(i);let m=l.shift();if(!["string","number","symbol"].includes(typeof m))throw new Error(`Property name/key ${m} invalid.`);function d(_,w=void 0){let g=M=>(_.value=M,a([...i,n.live||n.descripted?_:M],l,c));if(arguments.length>1)return g(w);if(!y(s))return g(s?.[_.key]);let h=v(s,"accessorizedProps",!1),I=h&&h.get(_.key);if(I&&I.intact())return g(I.getValue(n.withPropertyDescriptors));if(n.withPropertyDescriptors){let M=Object.getOwnPropertyDescriptor(s,_.key);return g(M)}return g(Reflect.get(s,_.key))}let p=new P(s,{type:"get",key:m,value:void 0,operation:"get",related:f});if(!y(s))return d(p);let b=R.getInstance(s,!1,n.namespace);return b?b.emit(p,d):d(p)}([],u.slice(0),a=>{let i=oe(e)?a:a[0];return o&&y(s)?Ve(s,e,t,n,r.key)(i):t(i)})},n)}function Ce(r,e,t={}){let n=D(r);return L.getInstance(n,!0,t.namespace).batch(e,t)}function xt(r,e,t={}){e=D(e),r=D(r);let n=(t.only||[]).slice(0),o=(t.except||[]).slice(0),s=Object.keys(t.spread?[...r]:r).map(i=>isNaN(i)?i:parseInt(i)),u=n.length?n.filter(i=>s.includes(i)):s.filter(i=>!o.includes(i)),f=i=>!Array.isArray(e)||isNaN(i)?i:i-o.filter(l=>l<i).length,a=i=>{let l=fe(r,i,t);"value"in l&&l.writable&&l.enumerable&&l.configurable?W(e,f(i),l.value,t):(l.enumerable||t.onlyEnumerable===!1)&&te(e,i,{...l,configurable:!0},t)};return Ce(e,()=>{u.forEach(a)}),qe(r,i=>{i.filter(l=>n.length?n.includes(l.key):!o.includes(l.key)).forEach(l=>{if(l.type==="delete")return re(e,f(l.key),t);if(l.type==="def"){(l.value.enumerable||t.onlyEnumerable===!1)&&te(e,f(l.key),{...l.value,configurable:!0},t);return}a(l.key)})},{...t,withPropertyDescriptors:!0})}function W(r,e,t,n=u=>u,o={},s=!1){let u=D(r),f=[[e,t]];x(e)&&([,,n=i=>i,o={},s=!1]=arguments,f=Object.entries(e)),x(n)&&([s,o,n]=[typeof o=="boolean"?o:s,n,i=>i]);let a=f.map(([i])=>i);return function i(l,c,m){if(!c.length)return m(l);let[d,p]=c.shift();function b(w,g=void 0){let h=Xe=>(w.status=Xe,i(l.concat(w),c,m));if(arguments.length>1)return h(w,g);let I=v(u,"accessorizedProps",!1),M=I&&I.get(w.key);return w.type==="def"?(M&&!M.restore()&&h(!1),Object.defineProperty(u,w.key,w.value),h(!0)):M&&M.intact()?h(M.setValue(w.value)):h(Reflect.set(u,w.key,w.value))}function _(w,g){if(o.diff&&p===g)return i(l,c,m);let h=new P(u,{type:s?"def":"set",key:d,value:p,isUpdate:w,oldValue:g,related:[...a],operation:s?"defineProperty":"set",detail:o.detail}),I=R.getInstance(u,!1,o.namespace);return I?I.emit(h,b):b(h)}return ue(u,d,w=>{if(!w)return _(w);if(d==="length"&&Array.isArray(u)&&v(u).has("$length"))return _(!0,v(u).get("$length"));let g={...o,withPropertyDescriptors:s};return N(u,d,h=>_(w,h),g)},o)}([],f.slice(0),i=>{let l=L.getInstance(u,!1,o.namespace);return l&&l.emit(i,{eventsArePropertyDescriptors:!!s}),n(oe(e)?i.map(c=>c.status):i[0]?.status)})}function te(r,e,t,n=s=>s,o={}){return W(r,e,t,n,o,!0)}function vt(r,e,t=o=>o,n={}){return W(r,e,t,n,!0)}function re(r,e,t=o=>o,n={}){let o=D(r);x(t)&&([n,t]=[t,f=>f]);let s=F(e,!1),u=[...s];return function f(a,i,l){if(!i.length)return l(a);let c=i.shift();function m(p,b=void 0){let _=h=>(p.status=h,f(a.concat(p),i,l));if(arguments.length>1)return _(p,b);let w=v(o,"accessorizedProps",!1),g=w&&w.get(p.key);return g&&!g.restore()&&_(!1),_(Reflect.deleteProperty(o,p.key))}function d(p){let b=new P(o,{type:"delete",key:c,oldValue:p,related:[...u],operation:"deleteProperty",detail:n.detail}),_=R.getInstance(o,!1,n.namespace);return _?_.emit(b,m):m(b)}return N(o,c,d,n)}([],s.slice(0),f=>{let a=L.getInstance(o,!1,n.namespace);return a&&a.emit(f),t(oe(e)?f.map(i=>i.status):f[0].status)})}function Pt(r,e,t=o=>o,n={}){return re(...arguments)}function Ie(r,e,t=null,n=s=>s,o={}){return A(r,"construct",arguments.length>2?{argumentsList:e,newTarget:t}:{argumentsList:e},n,o)}function Te(r,e,t,n=s=>s,o={}){let s=ee(e),u;if(Array.isArray(e)){if(o.arrayMethodName){let f=new P(s,{operation:o.arrayMethodName,argumentsList:t});L.getInstance(s,!1,o.namespace)?.emit([f],{eventIsArrayMethodDescriptor:!0})}v(s).set("$length",s.length),u=Ce(s,()=>A(r,"apply",{thisArgument:e,argumentsList:t},n,o),o),v(s).delete("$length")}else u=A(r,"apply",{thisArgument:s,argumentsList:t},n,o);return u}function Ae(r,e,t=o=>o,n={}){return A(r,"setPrototypeOf",{proto:e},t,n)}function je(r,e=n=>n,t={}){return A(r,"preventExtensions",{},e,t)}function Ve(r,e,t,n={}){let o=new AbortController;ae.setMaxListeners?.(0,o.signal),n.signal&&n.signal.addEventListener("abort",()=>o.abort());let s={...n,signal:o.signal},u=L.getInstance(r,!0,s.namespace),f=new Map;return function a(i=[],l=null){let c,m,d;if(oe(e)){if(l){d=!0,m=l;for(let p of i)f.get(p.key)?.remove(),f.delete(p.key)}else m=u.addRegistration(e,a,s);c={signal:m.signal,childRegistrations:f}}else l?.remove(),m=u.addRegistration(e,a,s),c={signal:m.signal};if(s.childRegistrations&&s.keyInParent&&s.childRegistrations.set(s.keyInParent,m),arguments.length){let p=t(i,c);if(arguments.length>1)return p}return o}}function A(r,e,t={},n=s=>s,o={}){r=D(r),x(n)&&([o,n]=[n,a=>a]);function s(a,i){return arguments.length>1?n(i):n((Reflect[e]||Object[e])(r,...Object.values(t)))}let u=new P(r,{operation:e,...t}),f=R.getInstance(r,!1,o.namespace);return f?f.emit(u,s):s(u)}function oe(r){return r===1/0||Array.isArray(r)}function D(r,e=!0,t=!0){if((!r||!y(r))&&e)throw new Error(`Object must be of type object or array! "${G(r)}" given.`);return r instanceof P&&(r.type==="def"&&t?r=typeof r.value.get=="function"?r.value.get():r.value.value:r=r.value),r&&ee(r)}function Ot(r,e,t,n={}){return e===1/0?n.level&&!y(r)?t([]):t(Object.entries(Object.getOwnPropertyDescriptors(r)).filter(([,o])=>o.writable!==!1&&!o.get&&!o.set).map(([o])=>o)):t(F(e,!1))}var S={...Le,...Oe},We=S;var Q=class extends le(EventTarget){#e;#t;constructor(e,{handshake:t=0,postAwaitsOpen:n=!1}={}){if(super(),typeof t!="number")throw new Error("handshake must be a number");if(t<0||t>2)throw new Error("handshake must be between 0 and 2");if(E(this).set("options",{handshake:t,postAwaitsOpen:n}),this.#e=typeof e=="string"?new WebSocket(e):e,this.constructor.upgradeEvents(this.#e,this),this.#t=new Promise(s=>{this.#e.readyState===WebSocket.OPEN?s():this.#e.addEventListener("open",()=>s(),{once:!0})}),t===0&&this.#t.then(()=>this.start()),this.#e.readyState===WebSocket.CLOSED)try{this.close()}catch{}else this.#e.addEventListener("close",()=>{try{this.close()}catch{}},{once:!0})}static _hydrateMessage(e,t){try{let n;if(typeof t.data=="string"&&x(n=JSON.parse(t.data))&&n[".wq"])return Object.defineProperty(t,"data",{value:n,configurable:!0}),super._hydrateMessage(e,t)}catch{}return t}__postMessage(e,t){this.#t.then(()=>{this.#e.send(JSON.stringify(e),t)})}_close(){this.#e.close()}};var Ue=(r,...e)=>$(r,"port+",...e),E=(r,...e)=>$(r,"port+","meta",...e),k=r=>$(r,"port+","meta").get("options")||{},He=["addEventListener","addRequestListener","postMessage","postRequest","dispatchEvent","relay","start","readyStateChange","removeEventListener","close"],Ge=["options","readyState","onmessage","onmessageerror"],O=class extends Ke(EventTarget){constructor({handshake:e=0,postAwaitsOpen:t=!1,...n}={}){if(typeof e!="number")throw new Error("handshake must be a number");if(e<0||e>2)throw new Error("handshake must be between 0 and 2");super(),Ue(this,"meta").set("options",{handshake:e,postAwaitsOpen:t,...n})}static[Symbol.hasInstance](e){return Function.prototype[Symbol.hasInstance].call(this,e)?!0:He.every(t=>typeof e[t]=="function")||Ge.every(t=>t in e)}};function Ke(r){return class extends r{static upgradeInPlace(e,{handshake:t=0,postAwaitsOpen:n=!1}={}){if(e instanceof O)return e;if(typeof t!="number")throw new Error("handshake must be a number");if(t<0||t>2)throw new Error("handshake must be between 0 and 2");let o=this.prototype;for(let u of He.concat("_autoStart")){let f=e[u],a=o[u];f&&Object.defineProperty(e,`_${u}`,{value:f.bind(e),configurable:!0}),Object.defineProperty(e,u,{value:a.bind(e),configurable:!0})}for(let u of Ge){let f=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),u),a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(o),u);f&&Object.defineProperty(e,`_${u}`,{...f,configurable:!0}),Object.defineProperty(e,u,{...a,configurable:!0})}return Ue(e,"meta").set("options",{handshake:t,postAwaitsOpen:n}),this.upgradeEvents(e),t===0&&e.start(),e}static upgradeEvents(e,t=null){t||(t=e);let n=E(e);if(n.get("events+"))return;let o=E(t),s=k(t),u=H.call(t),f=q.call(t);e instanceof BroadcastChannel&&(s.clientServerMode==="server"?o.set("clients",new Set):s.clientServerMode==="client"&&o.set("client_id",`client-${(0|Math.random()*9e6).toString(36)}`));let a=i=>{if(i instanceof j)return;if(e===t&&i.stopImmediatePropagation?.(),i=this._hydrateMessage?.(t,i)||i,i.data.ping==="connect"&&typeof i.data?.[".wq"]?.eventID=="string"&&(!(e instanceof WebSocket)||s.handshake)){let d=s.handshake===0||o.get("start.called"),p={isOpen:d};e instanceof BroadcastChannel&&(s.clientServerMode==="server"&&typeof i.data.id=="string"?(o.get("clients").add(i.data.id),p.id="server"):i.data.id==="server"&&o.has("client_id")&&(p.id=o.get("client_id"))),i.ports?.forEach(b=>b.postMessage(p)),d&&(o.set("remote.open.called",!0),t.start());return}if(i.data.ping==="disconnect"&&typeof i.data?.[".wq"]?.eventID=="string"){let d=()=>{o.set("remote.close.called",!0),t.close()};e instanceof BroadcastChannel?s.clientServerMode==="server"&&typeof i.data.id=="string"?(o.get("clients").delete(i.data.id),!o.get("clients").size&&s.autoClose&&!f.close.state&&d()):s.clientServerMode==="client"&&i.data.id==="server"&&d():e instanceof MessagePort&&d();return}let l=i.data,c={};typeof i.data?.[".wq"]?.eventID=="string"&&({message:l,".wq":c}=i.data);let m=new j(l,{originalTarget:e,...c,ports:i.ports});t.dispatchEvent(m)};n.set("internal_call",!0),e.addEventListener("message",a),e.addEventListener("error",a),n.delete("internal_call"),u.add(()=>{e.removeEventListener("message",a),e.removeEventListener("error",a),n.set("events+",!1)}),n.set("events+",!0)}get options(){return{...k(this)}}get onmessageerror(){return typeof super.onmessageerror<"u"?super.onmessageerror:typeof this._onmessageerror<"u"?this._onmessageerror:null}set onmessageerror(e){if(typeof super.onmessageerror<"u"){super.onmessageerror=e;return}if(e!==null&&typeof e!="function")throw new TypeError("onmessageerror must be a function");if(Object.getOwnPropertyDescriptor(this,"_onmessageerror")?.set){this._onmessageerror=e;return}this._onmessageerror&&this.removeEventListener("messageerror",this._onmessageerror),this.addEventListener("messageerror",e),this._onmessageerror=e}get onmessage(){return typeof super.onmessage<"u"?super.onmessage:typeof this._onmessage<"u"?this._onmessage:null}set onmessage(e){if(typeof super.onmessage<"u"){super.onmessage=e,this._autoStart();return}if(e!==null&&typeof e!="function")throw new TypeError("onmessage must be a function");if(Object.getOwnPropertyDescriptor(this,"_onmessage")?.set){this._onmessage=e,this._autoStart();return}this._onmessage&&this.removeEventListener("message",this._onmessage),this.addEventListener("message",e),this._onmessage=e,this._autoStart()}addEventListener(...e){H.call(this).add(()=>{this._removeEventListener?this._removeEventListener(...e):super.removeEventListener(...e)});let n=this._addEventListener?this._addEventListener(...e):super.addEventListener(...e);return this._autoStart(),n}dispatchEvent(e){let t=this._dispatchEvent?this._dispatchEvent(e):super.dispatchEvent(e);return e instanceof j&&Et.call(this,e),t}postMessage(e,t={}){this._autoStart();let n=q.call(this);n.messaging.state=!0,n.messaging.resolve(this);let o,{portOptions:s,wqOptions:{relayedFrom:u,...f}}=ce.call(this,e,t);(f.type!=="message"||f.live||f.bubbles||s.transfer?.length&&(this instanceof BroadcastChannel||this instanceof Q))&&(e={message:e,".wq":f}),t=s,o=u;let a=()=>{this._postMessage?this._postMessage(e,t,o):super.postMessage(e,t)};k(this).postAwaitsOpen?n.open.promise.then(a):a()}addRequestListener(e,t,n={}){let o=async s=>{let u=await t(s);for(let f of s.ports)f.postMessage(u)};this.addEventListener(e,o,n)}postRequest(e,t,n={}){let o;x(t)&&(n={once:!0,...t},o=new Promise(l=>{t=l}));let s=new MessageChannel;this.constructor.upgradeEvents(s.port1),s.port1.start();let{signal:u=null,once:f=!1,transfer:a=[],...i}=n;return s.port1.addEventListener("message",l=>t(l),{signal:u,once:f}),u?.addEventListener("abort",()=>{s.port1.close(),s.port2.close()}),this.postMessage(e,{...i,transfer:[s.port2].concat(a)}),o}relay({to:e,from:t,types:n="*",channel:o=null,resolveMessage:s=null,bidirectional:u=!1}={}){if(e&&t)throw new Error('Only one of "to" and "from" may be specified');if(t?e=this:t=this,e===t)throw new Error("Source and target ports cannot be the same");if(!(t instanceof O)||!(e instanceof O))throw new Error("Both source and target ports must be instance of MessagePortPlus.");if(typeof n!="function"&&!(n=[].concat(n)).length)throw new Error("Event types must be specified.");if(typeof o=="string")o={from:o};else if(x(o)){if(Object.keys(o).filter(l=>!["from","to"].includes(l)).length)throw new Error('Channel must be a string or an object of "from"/"to" members')}else if(o)throw new Error("Invalid channel parameter");let f=Je.call(t),a={targetPort:e,types:n,channel:o,resolveMessage:s};f.add(a);let i;return u&&(i=e.relay({to:t,types:n,channel:o&&{to:o.from,from:o.to},resolveMessage:s,bidirectional:!1})),()=>{f.delete(a),i?.()}}channel(e,t=null,{handshake:n=0,postAwaitsOpen:o=!1}={}){let s=new MessageChannel;return O.upgradeInPlace(s.port1,{handshake:n,postAwaitsOpen:o}),O.upgradeInPlace(s.port2,{handshake:n,postAwaitsOpen:o}),H.call(this).add(this.relay({channel:e,to:s.port2,bidirectional:!0,resolveMessage:t})),s.port2.start(),this.readyStateChange("close").then(()=>{s.port2.close()}),s.port1}projectMutations({from:e,to:t,...n}){if(!e||!t||typeof e=="string"&&typeof t=="string"||y(e)&&y(t))throw new Error('Invalid "from"/"to" parameters');if(typeof e=="string"){if(!y(t))throw new Error('Invalid "to" parameter. Object/array expected');return we.call(this,t,e,n)}if(typeof t=="string"){if(!y(e))throw new Error('Invalid "from" parameter. Object/array expected');return Qe.call(this,e,t,n)}throw new Error('Invalid "from"/"to" parameters')}get readyState(){let e=q.call(this);return e.close.state?"closed":e.open.state?"open":"connecting"}readyStateChange(e){if(!["open","messaging","close"].includes(e))throw new Error(`Invalid readyState query "${e}"`);return q.call(this)[e].promise}_autoStart(){let e=E(this),t=k(this);!e.get("internal_call")&&t.handshake===1&&this.start()}start(){let e=q.call(this);if(e.open.state)return;let t=E(this),n=k(this),o=i=>{i&&(e.open.state=!0,e.open.resolve(this));let l=t.get("handshake_channel");setTimeout(()=>{l?.port1.close(),l?.port2.close(),t.delete("handshake_channel")},100)};if(t.get("remote.open.called")){o(!0);return}if(t.get("start.called"))return;if(t.set("start.called",!0),this._start?this._start():super.start?.(),n.handshake===0){o(!0);return}let s=new MessageChannel;t.set("handshake_channel",s),s.port1.onmessage=i=>{this instanceof BroadcastChannel&&n.clientServerMode==="server"&&typeof i.data?.id=="string"&&t.get("clients").add(i.data.id),i.data?.isOpen,o(!0)};let{wqOptions:u}=ce.call(this),f=n.clientServerMode==="server"?"server":n.clientServerMode==="client"?t.get("client_id"):null,a={".wq":u,ping:"connect",id:f};this._postMessage?this._postMessage(a,{transfer:[s.port2]}):super.postMessage(a,{transfer:[s.port2]})}close(...e){let t=q.call(this);if(t.close.state)return;t.close.state=!0;let n=E(this),o=k(this);if(o.handshake>0&&!n.get("remote.close.called")&&(this instanceof BroadcastChannel||this instanceof MessagePort)){let{wqOptions:s}=ce.call(this),u=o.clientServerMode==="server"?"server":o.clientServerMode==="client"?n.get("client_id"):null,f={".wq":s,ping:"disconnect",id:u};this._postMessage?this._postMessage(f):super.postMessage(f)}this._close?this._close(...e):super.close(...e),t.close.resolve(this),Mt.call(this)}}}function le(r){return class extends Ke(r){static _hydrateMessage(e,t){if(typeof t.data?.[".wq"]?.numPorts!="number"||typeof t.data[".wq"].eventID!="string")return t;let n=H.call(e),o=t.data[".wq"].numPorts;Object.defineProperty(t,"ports",{value:[],configurable:!0});for(let s=0;s<o;s++){let u=e.channel(`${t.data[".wq"].eventID}:${s}`);t.ports.push(u)}return t}_postMessage(e,t={}){let{transfer:n=[],...o}=t;if(typeof e?.[".wq"]?.eventID=="string"){let s=H.call(this),u=n.filter(a=>a instanceof MessagePort),f=u.length;for(let a=0;a<f;a++)O.upgradeInPlace(u[a]),s.add(this.relay({channel:`${e[".wq"].eventID}:${a}`,to:u[a],bidirectional:!0})),u[a].start(),u[a].readyStateChange("close").then(()=>{let{wqOptions:i}=ce.call(this),l={".wq":i,ping:"disconnect"};this.postMessage(l,{type:`${e[".wq"].eventID}:${a}:message`})});e[".wq"].numPorts=f}return this.__postMessage(e,o)}}}function Et(r){if(r.propagationStopped)return;let e=E(this);e.get("parentNode")instanceof EventTarget&&(r.bubbles||e.get("parentNode")?.findPort?.(n=>n===this)&&r instanceof j)&&e.get("parentNode").dispatchEvent(r);let t=Je.call(this);if(t.size&&r instanceof j){let{type:n,eventID:o,data:s,live:u,bubbles:f,ports:a}=r,i=new WeakSet;for(let{targetPort:l,types:c,channel:m,resolveMessage:d}of t){if(i.has(l))continue;let p=n;m.from&&([,p]=new RegExp(`^${m.from.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}:([^:]+)$`).exec(n)||[],!p)||!(typeof c=="function"?c(p,this,l,m):[].concat(c).find(_=>_===p||_==="*"))||(i.add(l),l.postMessage(d?d(s,this,l,m):s,{transfer:a,type:m.to?`${m.to}:${p}`:p,eventID:o,bubbles:f,live:u,forwarded:!0,relayedFrom:this}))}}}function H(){let r=E(this);return r.has("garbage_collection")||r.set("garbage_collection",new Set),r.get("garbage_collection")}function Je(){let r=E(this);return r.has("downstream_registry")||r.set("downstream_registry",new Set),r.get("downstream_registry")}function q(){let r=E(this);if(!r.has("readystate_registry")){let e=t=>(t.promise=new Promise((n,o)=>(t.resolve=n,t.reject=o)),t);r.set("readystate_registry",{open:e({}),messaging:e({}),close:e({})})}return r.get("readystate_registry")}function Mt(){let r=E(this);for(let e of r.get("garbage_collection")||[])e instanceof AbortController?e.abort():typeof e=="function"&&e();r.get("garbage_collection")?.clear(),r.get("downstream_registry")?.clear()}function ce(r=void 0,e={}){if(Array.isArray(e))e={transfer:e};else if(!e||typeof e!="object")throw new TypeError("transferOrOptions must be an array or an object");let{type:t="message",eventID:n=null,live:o=!1,observing:s=!1,bubbles:u=!1,forwarded:f=!1,relayedFrom:a=null,signal:i=null,withArrayMethodDescriptors:l=!1,honourDoneMutationFlags:c=!1,...m}=e;return n||(n=`${t}-${(0|Math.random()*9e6).toString(36)}`),!s&&!f&&y(r)&&o&&!t?.endsWith(".mutate")&&(Qe.call(this,r,n,{signal:i,withArrayMethodDescriptors:l,honourDoneMutationFlags:c}),s=!0),{portOptions:m,wqOptions:{type:t,eventID:n,live:o,observing:s,honourDoneMutationFlags:c,bubbles:u,forwarded:f,relayedFrom:a}}}function Qe(r,e,{signal:t,withArrayMethodDescriptors:n=!0,honourDoneMutationFlags:o=!1}={}){if(!y(r))throw new TypeError("data must be a plain object and not a stream");if(typeof e!="string")throw new TypeError("eventID must be a non-empty string");let s=a=>{let i;n&&Array.isArray(a[0].target)&&!a[0].argumentsList&&!["set","defineProperty","deleteProperty"].includes(a[0].operation)||(this.postMessage(a.map(l=>(i=!i&&o&&l.detail?.done,{...l,target:void 0})),{type:`${e}.mutate`}),i&&u.abort())},u=S.observe(r,S.subtree(),s,{signal:t,withArrayMethodDescriptors:n});return H.call(this).add(u),u}function we(r,e,{signal:t,honourDoneMutationFlags:n=!1}={}){if(!y(r))throw new TypeError("data must be a plain object and not a stream");if(typeof e!="string")throw new TypeError("eventID must be a non-empty string");let o=f=>{if(!f.data?.length)return;let a;S.batch(r,()=>{for(let i of f.data){if(a=!a&&n&&i.detail?.done,i.argumentsList){let l=i.path.length?S.get(r,S.path(...i.path)):r;S.proxy(l)[i.operation](...i.argumentsList);continue}if(i.key!=="length"||["set","defineProperty","deleteProperty"].includes(i.operation)){let l=i.path.length===1?r:S.get(r,S.path(...i.path.slice(0,-1)));i.type==="delete"?S.deleteProperty(l,i.key):S.set(l,i.key,i.value)}}}),a&&s()};this.addEventListener(`${e}.mutate`,o,{signal:t});let s=()=>this.removeEventListener(`${e}.mutate`,o);return H.call(this).add(s),s}var pe=class extends le(BroadcastChannel){constructor(e,{handshake:t=0,postAwaitsOpen:n=!1,clientServerMode:o=null,autoClose:s=!1}={}){super(e);let u=E(this);if(typeof t!="number")throw new Error("handshake must be a number");if(t<0||t>2)throw new Error("handshake must be between 0 and 2");if(o&&!["server","client"].includes(o))throw new Error('clientServerMode must be "server" or "client"');u.set("options",{handshake:t,postAwaitsOpen:n,clientServerMode:o,autoClose:s}),this.constructor.upgradeEvents(this),t===0&&this.start()}__postMessage(e,t){BroadcastChannel.prototype.postMessage.call(this,e)}};var me=class extends MessageChannel{constructor({handshake:e=0,postAwaitsOpen:t=!1}={}){super(),[this.port1,this.port2].forEach((n,o)=>{O.upgradeInPlace(n,{handshake:e,postAwaitsOpen:t})})}};var X=class extends O{#e=new Set;#t=!1;#r=!1;get length(){return this.#e.size}[Symbol.iterator](){return this.#e[Symbol.iterator]()}constructor({handshake:e=0,postAwaitsOpen:t=!1,autoClose:n=!1}={}){super({handshake:e,postAwaitsOpen:t,autoClose:n}),e===0&&this.start()}addPort(e,{enableBubbling:t=!0}={}){if(!(e instanceof O))throw new TypeError("Port must be a WQMessagePort instance.");let n=q.call(this);if(this.#r||n.close.state){let u=this.constructor.name;throw new Error(`Cannot add port to ${u}. ${u} is closed.`)}if(this.#e.has(e))return;this.#e.add(e);let o=E(e);if(t){if(o.get("parentNode"))throw new TypeError("Incoming port already has a parent node.");o.set("parentNode",this)}this.options.handshake&&(e.readyStateChange("open").then(()=>{n.open.state=!0,n.open.resolve(this)}),e.readyStateChange("close").then(()=>s())),(this.#t||n.open.state)&&e.start();let s=()=>{this.#e.has(e)&&(this.#e.delete(e),t&&o.get("parentNode")===this&&o.set("parentNode",null),this.#e.size===0&&k(this).autoClose&&(n.close.state=!0,n.close.resolve(this)))};return s}findPort(e){for(let t of this.#e)if(e(t))return t}_postMessage(e,t,n){for(let o of this.#e)o!==n&&o.postMessage(e,t)}start(){if(!this.#t){this.#t=!0;for(let e of this.#e)e.start();if(!this.options.handshake){let e=q.call(this);e.open.state=!0,e.open.resolve(this)}}}close(...e){if(!this.#r){this.#r=!0;for(let t of this.#e)t.close(...e);if(!this.options.handshake){let t=q.call(this);t.close.state=!0,t.close.resolve(this)}}}};var he=class extends X{#e;get channelSpec(){return this.#e}constructor(e=null,t={}){if(super(t),typeof e=="string")e={from:e,to:e};else if(x(e)){if(Object.keys(e).filter(n=>!["from","to"].includes(n)).length)throw new Error('Channel must be a string or an object of "from"/"to" members')}else if(e)throw new Error("Invalid channel parameter");this.#e=e}addPort(e,{resolveMessage:t=null,...n}={}){let o=(l,...c)=>t?t(l,...c):l,s=super.addPort(e,n),u=e.relay({channel:this.#e,to:this,bidirectional:!1,resolveMessage:o}),f=this.#e.from&&`${this.#e.from}:message`||"message";this.postMessage(o({event:"joins"},e,this),{type:f,relayedFrom:e});let a=()=>{this.postMessage(o({event:"leaves"},e,this),{type:f,relayedFrom:e})},i=()=>{a(),u(),s()};return e.readyStateChange("close").then(i),i}};globalThis.webqit||(globalThis.webqit={});Object.assign(globalThis.webqit,Re);})();
//# sourceMappingURL=main.js.map
